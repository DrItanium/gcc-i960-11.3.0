;;- Machine description for Intel i960
;;   Copyright (C) 2022-2023 Joshua Scoggins

;; This file is part of GCC.
;;
;; GCC is free software; you can redistribute it and/or modify
;; it under the terms of the GNU General Public License as published by
;; the Free Software Foundation; either version 3, or (at your option)
;; any later version.
;;
;; GCC is distributed in the hope that it will be useful,
;; but WITHOUT ANY WARRANTY; without even the implied warranty of
;; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
;; GNU General Public License for more details.
;;
;; You should have received a copy of the GNU General Public License
;; along with GCC; see the file COPYING3.  If not see
;; <http://www.gnu.org/licenses/>.

;;- See file "rtl.def" for documentation on define_insn, match_*, et. al.
(include "constraints.md")
(include "predicates.md")
;; taken from the previous implementation
(define_attr "type"
  "move,arith,alu2,mult,div,modscan,load,store,branch,call,address,compare,fpload,fpstore,fpmove,fpcvt,fpcc,fpadd,fpmul,fpdiv,multi,misc"
  (const_string "arith"))

;; taken from the previous implementation
(define_attr "length" ""
  (cond [(eq_attr "type" "load,fpload")
	      (if_then_else (match_operand 1 "i960_symbolic_memory_operand" "")
			    (const_int 2)
			    (const_int 1))
	 (eq_attr "type" "store,fpstore")
	      (if_then_else (match_operand 0 "i960_symbolic_memory_operand" "")
			    (const_int 2)
			    (const_int 1))
	 (eq_attr "type" "address")
	      (const_int 2)]
	(const_int 1)))
(define_insn "nop"
 [(const_int 0)]
 ""
 "")

(define_insn "return"
 [(return)]
 "true"
 "ret")

(define_insn "jump"
 [(set (pc) (label_ref (match_operand 0 "" "")))]
 ""
 "b\t%0%#"
 [(set_attr "type" "branch")]
 )
;; this one is a guess at this point
(define_insn "indirect_jump"
 [(set (pc) (match_operand:SI 0 "address_operand" "p"))]
 ""
 "bx\t%a0"
 [(set_attr "type" "branch")]
 )

(define_expand "prologue"
 [(const_int 1)]
 ""
 {
    // @todo implement
    DONE;
 })

(define_expand "epilogue"
 [(return)]
 ""
 {
    // @todo implement
    DONE;
 })
